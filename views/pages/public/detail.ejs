<%- include ../../partials/public/header -%>
		<!--endheader-->
        <div class="container-fluid">

            <div class="book-show" itemscope="" itemtype="http://schema.org/Book">
                <div class="col-xs-12 col-md-8">
                    <div class="col-xs-12 book-name header-text">
                        <h1 itemprop="name"><%= book.mName %></h1></div>
                    <div class="col-xs-4 col-sm-3 book-cover">
                        <div>
                            <div class="item-cover">
                                <div class="image size-ad">
                                    <div id="w0">
										<a class="gallery-item">
											<img src="/files/images/<%= book.mImage %>"  class="shadow-lg"></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-8 col-sm-9 book-details-outher">
                        <div class="book-details">
                            <div class="details-row text-row">
                                <span class="details-header">Authors:</span>
                                <a href="/author/<%=slug.createSlug(book.mAuthor)%>" class="authors-list details-info"><%= book.mAuthor %></span>
                                <div class="clear"></div>
							</div>
							<% 
								if(book.mSeriesId != 0) {
								var index = 1;
								
								for(var i = 0; i < listSeriesById.length; i++){
									if(book.mId == listSeriesById[i].mId) {
										index = i + 1;
										
										break;
									}
								}
							%>
                            <div class="details-row text-row">
                                <span class="details-header">Series:</span>
                                <span class="series-list details-info">
									<a href="/series/<%=slug.createSlug(book.mSeriesName)%>/<%=book.mSeriesId%>" title="Read The Dark Tower Series"><%=book.mSeriesName %></a>(#<%= index %>)
								</span>
                                <div class="clear"></div>
							</div>
							<% } %>
                            <div class="details-row text-row">
                                <span class="details-header">Categories:</span>
                                <span class="categories-list details-info">
								<a href="/<%= slug.createSlug(book.mCatName)%>/<%= book.mCatId%>" title="<%= book.mCatId %>"><%= book.mCatName %></a></span>
                                <div class="clear"></div>
                            </div>
                            <div class="details-row hidden-xs">
                                <span class="details-header">Rating:</span>
                                <span class="book-rating details-info">

									<div class="xb-rater desktop" data-role="static" data-model-id="1" data-item-id="565906">
										<div class="rating-container rating-xss static rating-animate rating-disabled">
											<div class="rating">
												<span class="empty-stars">
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
												</span>
												<%
												 var mark = 0;
												if(book.mAvgScore != null) {
													mark = book.mAvgScore.toFixed(1);
												 }
												%>
												<span class="filled-stars" style="width: <%=mark*10 %>%;">
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
													<span class="star"><i class="glyphicon glyphicon-star"></i></span>
												</span>
											</div>
											<input type="text" id="w1" class="hide" name="all-rating" value="<%=mark %>" readonly="readonly" data-krajee-rating="rating_ca9ad511">
										</div>
										<span class="caption" itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating">
											<span itemprop="ratingValue" id="avg-score" class="current-rating"><%=mark %></span>/<span itemprop="bestRating">10</span> (<span itemprop="ratingCount" class="current-count" id="sum-vote"><%= book.mSumVote%></span> votes)
										</span>
										<div class="clear"></div>
									</div>
								</span>
								<div class="clear"></div>
							</div>
							<%
								if(typeof userLogin !== 'undefined'){

							%>
							<div class="details-row hidden-xs details-rating-desktop rating-stars">
								<span class="details-header">Your rating:</span>
								<ul id='stars'>
									<li class='star' data-value='1'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='2'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='3'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='4'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='5'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='6'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='7'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='8'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='9'><i class='glyphicon glyphicon-star'></i></li>
									<li class='star' data-value='10'><i class='glyphicon glyphicon-star'></i></li>
									<li style="display:inline-block">
										<span style="font-weight:bold;" id="yourrate">0</span>/<span>10</span>
									</li>
								</ul>
								
								<div class="clear"></div>
								<script>

									$(document).ready(function(){
										
									  $('#stars li').on('mouseover', function(){
										var onStar = parseInt($(this).data('value'), 10);
									   
										$(this).parent().children('li.star').each(function(e){
										  if (e < onStar) {
											$(this).addClass('hover');
										  }
										  else {
											$(this).removeClass('hover');
										  }
										  var msg = "0";
										  if(onStar >0 && onStar <= 10){
										  	msg = onStar;
										  }
										  responseMessage(msg);
										});
										
									  }).on('mouseout', function(){
										$(this).parent().children('li.star').each(function(e){
										  $(this).removeClass('hover');
										});
									  });
									  
									  
									  
									  $('#stars li').on('click', function(){
										var onStar = parseInt($(this).data('value'), 10);
										var stars = $(this).parent().children('li.star');
										
										for (i = 0; i < stars.length; i++) {
										  $(stars[i]).removeClass('selected');
										}
										
										for (i = 0; i < onStar; i++) {
										  $(stars[i]).addClass('selected');
										}
										
										
										var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
										
										if (ratingValue > 1) {
											
											vote(ratingValue);
										}
										
										
										
									  });
									  
									  
									});


									function responseMessage(msg) {
									    
									  $('#yourrate').html(msg);
									}
									function vote(score){
										var data = {};
										data.sumScore = score + <%=book.mSumScore%>;
										data.id = <%=book.mId%>;
										data.sumVote = <%=book.mSumVote%> + 1;
										$.ajax({
											url: '/vote',
											type: 'POST',
											cache: false,
											data: JSON.stringify(data),
											contentType: 'application/json',
											success: function(data){
												$('#stars').html("Rated!");
												var avgScore = (data.sumScore / data.sumVote).toFixed(2);
												
												$('#avg-score').html(avgScore);
												$('#sum-vote').html(data.sumVote);
											},
											error: function (){
											}
										});
									}
								</script>
							</div> 
							
							<div style="padding-top:10px;" class="details-row text-row">
                                <span class="details-header">Love :</span>
                                <%
									if(isLiked == 0){
								%>
								<span class="heart" data-value='1'><i class='glyphicon glyphicon-heart'></i></span>
								<%}else{%>	
								<span class="heart selected" data-value='0'><i class='glyphicon glyphicon-heart'></i></span>
                                <%}%>
								<div class="clear"></div>
                                <script>
									$(document).ready(function(){
										
									 	$('span.heart').on('click', function(){
									 		var status = $('span.heart').attr('data-value');
									 		
									 		like(status);
									 	});
										
									});
									
									function like(status){
										var data = {};
										data.status = status;
										data.userId = <%=userLogin.id%>;
										data.bookId = <%=book.mId%>;
										$.ajax({
											url: '/like',
											type: 'POST',
											cache: false,
											data: JSON.stringify(data),
											contentType: 'application/json',
											success: function(result){
												$('span.heart').toggleClass('selected');
												
												$('span.heart').attr('data-value',result.status);
											},
											error: function (){
												
											}
										});
									}
								</script>
                            </div>
                            <%}%>
						</div>

						
					</div>
					
					<div class="col-xs-12 col-sm-9 book-description" itemprop="description">
						<span class="show-more-text">
							<span class="visible-text">
								<p style="display: inline;"><%=stringUtil.makePreview(book.mSummary) %></p>
							</span>
							<span class="splitter-text">...</span>
							<span class="toggle-text">
								<p style="display: inline;"><%=stringUtil.showMore(book.mSummary) %></p>
							</span>
							<a class="more-button more-small visible-xs" href="javascript:;">
								<span class="on-small">More</span>
								<span class="on-big">Less</span>
							</a>
							<a class="more-button more-big hidden-xs" href="javascript:;">
								<span class="on-small">Show More <span class="glyphicon glyphicon-chevron-down"></span></span>
								<span class="on-big">Show Less <span class="glyphicon glyphicon-chevron-up"></span></span>
							</a>
						</span>
					</div>
					
					<div class="col-xs-12 book-mini-reader">

						<iframe id="fred" style="border:1px solid #666CCC" title="PDF in an i-Frame" src="/files/pdf/<%= book.mFileName %>" frameborder="1" scrolling="auto" height="600px" width="100%" ></iframe>
						
					</div>
					<div class="col-xs-12">

						<div class="xb-comments-block">
							<div class="xb-comment-form">
								<h2>Write Review</h2>

								<div class="media">
									<div class="media-left">
										<img class="media-object" src="/files/images/nophoto.png" alt="Guest">
									</div>
									<div class="media-body">
										<% if(typeof userLogin === 'undefined') {%>
										<h4 class="media-heading"><span class="username">Guest</span></h4>
										<% } else { %>
											<h4 class="media-heading"><span class="username"><%=userLogin.username %></span></h4>
										<% } %>
										<div class="form-group send-comment">
										<form id="comment-form">
											<textarea class="form-control" id="content" name="content" rows="2" placeholder="Do you like the plot of book? Can you recommend something similar books?"></textarea>
											<div id="error_validate"></div>
											<div class="submit-block">
												<div class="message-block text-danger"></div>
												<input onclick="doComment()" type="button" class="btn1" value="Send" />
											</div>
										</form>
										</div>
									</div>
								</div>
							</div>
							<div class="xb-comments-list">
								<div class="comments-header">
								   <h2>User Reviews</h2>
								</div>
								<div id="newComment"></div>
								<%
								if(typeof listOfComment !== 'undefined' && listOfComment.length > 0){
									for(var i = 0; i < listOfComment.length; i++) {
								%>
								<div class="comments-list">
								   <div class="media">
									  <div class="media-left">
										 <a href="javascript:;">
										 <img class="media-object" src="/files/images/nophoto.png" alt="<%=listOfComment[i].mUsername %>">
										 </a>
									  </div>
									  <div class="media-body">
										 <h4 class="media-heading">
											<span class="username"><%=listOfComment[i].mUsername %></span>
											<span class="date"><%=listOfComment[i].mCreateAt.getDate() %>/<%=listOfComment[i].mCreateAt.getMonth() + 1%>/<%=listOfComment[i].mCreateAt.getFullYear() %></span>
										 </h4>
										 <%=listOfComment[i].mContent %>
									  </div>
								   </div>
								</div>
								<% }} %>
							 </div>
						</div>
					</div>
				</div>
				<% if(typeof userLogin !== 'undefined') {%>
				<script>
					function doComment(){
						var data = {};
						data.idUser = <%=userLogin.id%>;
						data.username = "<%=userLogin.username%>";
						data.idBook = <%=book.mId%>;
						data.content = $("#content").val();
						
						if(data.content == "") {
							$("#error_validate").html("<h5 style='text-align: left; color: red; font-weight:bold'>Please enter this field</h5>");
						} else {
							document.getElementById("error_validate").innerHTML = "";
							document.getElementById("content").value = "";
							$.ajax({
							url: '/comment',
							type: 'POST',
							cache: false,
							data: JSON.stringify(data),
							contentType: 'application/json',
							success: function(data){
								$('#newComment').append("<div class='comments-list'> " +
									"<div class='media'>" + 
										"<div class='media-left'>" + 
										"<a href='javascript:;'>" + 
										"<img class='media-object' src='/files/images/nophoto.png' alt='" + data.username + "'>" +
										"</a>" +
									"</div>" +
									"<div class='media-body'>" +
										"<h4 class='media-heading'>" +
											"<span class='username'>" + data.username + "</span>" +
										"<span class='date'>just now</span>" +
										"<a href='javscript:;' class='approve-text' data-toggle='tooltip' data-placement='top' title='Message will shown on site after approval. Only logged users can see all their comments!'>" +
										"<span class='glyphicon glyphicon-eye-close'></span>" +
										"</a>" + 
										"</h4>" + data.content +
									"</div>" +
								"</div>" +
								"</div>");
							},
							error: function (){
							}
						});
						}
					}
				</script>
				<%} else {%>
					<script>
						function doComment(){
							alert("You have to login");
							document.getElementById("content").value = "";
						}
					</script>
				<%}%>
				<script type="text/javascript">
					$(document).ready(function() {
						$("#comment-form").validate({
							ignore: [],
							debug: false,
							rules: {
							  content: { 
								  required : true,
								  minlength: 30
							  }
							},
							messages: {
								content: 
								{
									required : "Please enter this field",
									minlength : "The length of username must be longer than 30"
								}
							}
						});
					});
				</script>
				<!--rightbar-->
				<%- include ../../partials/public/right-bar -%>
				<!--endrightbar-->

			</div>
		</div>
    </div>
<%- include ../../partials/public/footer -%>
    